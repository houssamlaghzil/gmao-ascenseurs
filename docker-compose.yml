# =============================================================================
# Docker Compose - GMAO Ascenseurs
# =============================================================================
# Usage:
#   1. Copier .env.example vers .env et renseigner les variables
#   2. docker compose up -d --build
#   3. Accéder à http://localhost:3000
# =============================================================================

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Variables passées au build (pour NEXT_PUBLIC_*)
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:3000}
    image: gmao-ascenseurs:latest
    container_name: gmao-ascenseurs
    
    # Charger automatiquement les variables depuis .env
    env_file:
      - .env
    
    # Variables d'environnement (peuvent override celles du .env)
    environment:
      - NODE_ENV=production
      - PORT=3000
      - HOSTNAME=0.0.0.0
      # Variables runtime (non-NEXT_PUBLIC_*)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
    
    ports:
      - "${PORT:-3000}:3000"
    
    # Volumes pour persister les données
    volumes:
      - gmao_data:/app/data
    
    restart: unless-stopped
    
    # Logging configuré
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # Ressources limitées (optionnel, décommenter si nécessaire)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.25'
    #       memory: 256M

volumes:
  gmao_data:
    driver: local
